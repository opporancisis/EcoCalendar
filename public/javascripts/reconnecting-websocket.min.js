!function(e,n){"function"==typeof define&&define.amd?define([],n):"undefined"!=typeof module&&module.exports?module.exports=n():e.ReconnectingWebSocket=n()}(this,function(){function e(n,o){function t(l){c=new WebSocket(n,o),l||i.onconnecting(),(i.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","attempt-connect",n);var r=c,d=setTimeout(function(){(i.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","connection-timeout",n),u=!0,r.close(),u=!1},i.timeoutInterval);c.onopen=function(o){clearTimeout(d),(i.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","onopen",n),i.readyState=WebSocket.OPEN,l=!1,i.reconnectAttempts=0,i.onopen(o)},c.onclose=function(o){clearTimeout(d),c=null,s?(i.readyState=WebSocket.CLOSED,i.onclose(o)):(i.readyState=WebSocket.CONNECTING,i.onconnecting(),l||u||((i.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","onclose",n),i.onclose(o)),setTimeout(function(){i.reconnectAttempts++,t(!0)},i.reconnectInterval*Math.pow(i.reconnectDecay,i.reconnectAttempts)))},c.onmessage=function(o){(i.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","onmessage",n,o.data),i.onmessage(o)},c.onerror=function(o){(i.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","onerror",n,o),i.onerror(o)}}o=o||[],this.debug=!1,this.reconnectInterval=1e3,this.reconnectDecay=1.5,this.reconnectAttempts=0,this.timeoutInterval=2e3;var c,i=this,s=!1,u=!1;this.url=n,this.protocols=o,this.readyState=WebSocket.CONNECTING,this.URL=n,this.onopen=function(){},this.onclose=function(){},this.onconnecting=function(){},this.onmessage=function(){},this.onerror=function(){},t(!1),this.send=function(o){if(c)return(i.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","send",n,o),c.send(o);throw"INVALID_STATE_ERR : Pausing to reconnect websocket"},this.close=function(){s=!0,c&&c.close()},this.refresh=function(){c&&c.close()}}return e.debugAll=!1,e});